<!-- Clean Header Section - No inline styles! -->
<header class="header {% if section.settings.style == 'primary' %}header--primary{% endif %} {% if section.settings.sticky %}header--sticky{% endif %}" 
        id="section-{{ section.id }}"
        role="banner">
  <div class="container">
    <div class="header__container">
      
      <!-- Logo -->
      {% for block in section.blocks %}
        {% if block.type == 'logo' %}
          <div class="header__logo" >
            <a href="/" aria-label="Home">
              {% if block.settings.logo_type == 'image' and block.settings.logo != blank %}
                <img src="{{ block.settings.logo | image_picker_url: 'logo.png' }}" 
                     alt="{{ block.settings.image_alt | default: site.title }}"
                     width="{{ block.settings.logo_width | default: '120' }}"
                     height="auto">
              {% else %}
                <span class="header__logo-text">{{ block.settings.logo_text | default: site.title }}</span>
              {% endif %}
            </a>
          </div>
        {% endif %}
      {% endfor %}
      
      <!-- Navigation -->
      <nav class="header__nav" role="navigation">
        {% for block in section.blocks %}
          {% case block.type %}
            
            {% when 'menu' %}
              <div class="header__menu" >
                {% for link in current_site.link_lists[block.settings.menu].links %}
                  <a href="{{ link.url }}" 
                     class="header__link"
                     {% if block.settings.new_tab %}target="_blank" rel="noopener"{% endif %}>
                    {{ link.name }}
                  </a>
                {% endfor %}
              </div>
            
            {% when 'user' %}
              <div class="header__user" >
                {% if current_site_user %}
                  <div class="dropdown">
                    <button class="dropdown__trigger header__link" aria-expanded="false">
                      {{ current_site_user.first_name | default: "Menu" }}
                      <svg class="dropdown__arrow" width="12" height="8" viewBox="0 0 12 8" fill="currentColor">
                        <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" fill="none"/>
                      </svg>
                    </button>
                    <div class="dropdown__menu">
                      <a href="/library" class="dropdown__link">{{ block.settings.language_library | default: 'My Library' }}</a>
                      {{ block.settings.language_settings | default: 'Settings' | member_settings_link: class: 'dropdown__link' }}
                      {{ block.settings.language_logout | default: 'Log Out' | member_logout_link: class: 'dropdown__link' }}
                    </div>
                  </div>
                {% else %}
                  {{ block.settings.language_login | default: 'Log In' | member_login_link: class: 'header__link' }}
                {% endif %}
              </div>
            
            {% when 'button' %}
              <div class="header__cta" >
                <a href="{{ block.settings.button_link }}" 
                   class="btn btn--small {% if block.settings.button_style == 'primary' %}btn--primary{% else %}btn--secondary{% endif %}"
                   {% if block.settings.new_tab %}target="_blank" rel="noopener"{% endif %}>
                  {{ block.settings.button_text }}
                </a>
              </div>
              
          {% endcase %}
        {% endfor %}
      </nav>
      
      <!-- Mobile Menu Toggle -->
      <button class="header__mobile-toggle hide-desktop" aria-label="Menu" aria-expanded="false">
        <span class="header__mobile-toggle-line"></span>
        <span class="header__mobile-toggle-line"></span>
        <span class="header__mobile-toggle-line"></span>
      </button>
      
    </div>
  </div>
</header>

<script>
  // Simple mobile menu toggle
  document.addEventListener('DOMContentLoaded', function() {
    const header = document.getElementById('section-{{ section.id }}');
    const mobileToggle = header.querySelector('.header__mobile-toggle');
    const dropdownTriggers = header.querySelectorAll('.dropdown__trigger');
    
    // Mobile menu toggle
    if (mobileToggle) {
      mobileToggle.addEventListener('click', function() {
        header.classList.toggle('header--mobile-open');
        this.setAttribute('aria-expanded', header.classList.contains('header--mobile-open'));
      });
    }
    
    // Dropdown toggles
    dropdownTriggers.forEach(trigger => {
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        const isOpen = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isOpen);
        this.parentElement.classList.toggle('dropdown--open');
      });
    });
    
    // Close dropdowns on outside click
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.dropdown')) {
        dropdownTriggers.forEach(trigger => {
          trigger.setAttribute('aria-expanded', 'false');
          trigger.parentElement.classList.remove('dropdown--open');
        });
      }
    });
  });
</script>

{% schema %}
{
  "name": "Header",
  "elements": [
    {
      "type": "select",
      "id": "style",
      "label": "Header Style",
      "options": [
        { "value": "default", "label": "Default (White)" },
        { "value": "primary", "label": "Primary (Brand Color)" }
      ],
      "default": "primary"
    },
    {
      "type": "checkbox",
      "id": "sticky",
      "label": "Sticky Header",
      "default": true,
      "info": "Header stays at top when scrolling"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "limit": 1,
      "settings": [
        {
          "type": "radio",
          "id": "logo_type",
          "label": "Logo Type",
          "options": [
            { "value": "image", "label": "Image" },
            { "value": "text", "label": "Text" }
          ],
          "default": "text"
        },
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Logo Image",
          "info": "Recommended: 240x60px"
        },
        {
          "type": "text",
          "id": "logo_text",
          "label": "Logo Text",
          "default": "AttachmentNerd"
        },
        {
          "type": "text",
          "id": "logo_width",
          "label": "Logo Width (px)",
          "default": "120"
        },
        {
          "type": "text",
          "id": "image_alt",
          "label": "Logo Alt Text",
          "default": "Logo"
        }
      ]
    },
    {
      "type": "menu",
      "name": "Menu",
      "settings": [
        {
          "type": "link_list",
          "id": "menu",
          "label": "Menu",
          "default": "main-menu"
        },
        {
          "type": "checkbox",
          "id": "new_tab",
          "label": "Open links in new tab",
          "default": false
        }
      ]
    },
    {
      "type": "user",
      "name": "User Menu",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "language_login",
          "label": "Login Text",
          "default": "Log In"
        },
        {
          "type": "text",
          "id": "language_logout",
          "label": "Logout Text",
          "default": "Log Out"
        },
        {
          "type": "text",
          "id": "language_library",
          "label": "Library Text",
          "default": "My Library"
        },
        {
          "type": "text",
          "id": "language_settings",
          "label": "Settings Text",
          "default": "Settings"
        }
      ]
    },
    {
      "type": "button",
      "name": "Call to Action",
      "settings": [
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Get Started"
        },
        {
          "type": "action",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "radio",
          "id": "button_style",
          "label": "Button Style",
          "options": [
            { "value": "primary", "label": "Primary" },
            { "value": "secondary", "label": "Secondary" }
          ],
          "default": "secondary"
        },
        {
          "type": "checkbox",
          "id": "new_tab",
          "label": "Open in new tab",
          "default": false
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "logo"
      },
      {
        "type": "menu"
      },
      {
        "type": "user"
      }
    ]
  }
}
{% endschema %}
