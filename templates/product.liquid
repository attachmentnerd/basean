{% comment %}
  Product Detail Template - Kajabi Version
  Displays individual product with purchase options
{% endcomment %}

<div class="product-wrapper" itemscope itemtype="http://schema.org/Product">
  <div class="container">
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item">
          <a href="{{ routes.root_url }}">Home</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{{ routes.products_url }}">Products</a>
        </li>
        <li class="breadcrumb-item is-active" aria-current="page">
          {{ product.title }}
        </li>
      </ol>
    </nav>
    
    <div class="product-content">
      <div class="product-media">
        {% if product.featured_image %}
          <div class="product-image-main">
            <img src="{{ product.featured_image | image_url: 'master' }}" 
                 alt="{{ product.title }}" 
                 itemprop="image"
                 class="product-image">
          </div>
        {% endif %}
        
        {% if product.images.size > 1 %}
          <div class="product-thumbnails">
            {% for image in product.images %}
              <button class="thumbnail-button {% if forloop.first %}is-active{% endif %}" 
                      data-image="{{ image | image_url: 'master' }}">
                <img src="{{ image | image_url: '100x100' }}" alt="Product image {{ forloop.index }}">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>
      
      <div class="product-info">
        <header class="product-header">
          <h1 class="product-title" itemprop="name">{{ product.title }}</h1>
          
          {% if product.subtitle %}
            <p class="product-subtitle">{{ product.subtitle }}</p>
          {% endif %}
          
          {% if product.instructor %}
            <p class="product-instructor">by {{ product.instructor }}</p>
          {% endif %}
        </header>
        
        <div class="product-description rte" itemprop="description">
          {{ product.description }}
        </div>
        
        {% if product.offers %}
          <div class="product-offers">
            <h3 class="offers-title">Choose Your Plan</h3>
            {% for offer in product.offers %}
              <div class="offer-item">
                <div class="offer-header">
                  <h4 class="offer-name">{{ offer.name }}</h4>
                  <div class="offer-price">
                    <span class="price-current">{{ offer.price | money }}</span>
                    {% if offer.payment_plan %}
                      <span class="price-plan">{{ offer.payment_plan_details }}</span>
                    {% endif %}
                  </div>
                </div>
                <div class="offer-actions">
                  <a href="{{ offer.checkout_url }}" class="btn btn--primary">
                    Get Access
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="product-price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
            <span class="price-current" itemprop="price">{{ product.price | money }}</span>
            <meta itemprop="priceCurrency" content="{{ site.currency }}">
          </div>
          
          <div class="product-actions">
            {% if member and product.enrollment_status == 'enrolled' %}
              <a href="{{ product.url }}" class="btn btn--primary btn--large">
                Continue Learning
              </a>
              <p class="product-progress">Progress: {{ product.user_progress }}%</p>
            {% else %}
              <a href="{{ product.checkout_url }}" class="btn btn--primary btn--large">
                Get Access
              </a>
            {% endif %}
          </div>
        {% endif %}
        
        {% if product.features %}
          <div class="product-features">
            <h3 class="features-title">What's Included</h3>
            <ul class="features-list">
              {% for feature in product.features %}
                <li class="feature-item">
                  {% render 'icon', icon: 'check' %}
                  {{ feature }}
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
        
        {% if product.lessons_count %}
          <div class="product-stats">
            <div class="stat-item">
              <span class="stat-value">{{ product.lessons_count }}</span>
              <span class="stat-label">Lessons</span>
            </div>
            {% if product.duration %}
              <div class="stat-item">
                <span class="stat-value">{{ product.duration }}</span>
                <span class="stat-label">Duration</span>
              </div>
            {% endif %}
            {% if product.students_count %}
              <div class="stat-item">
                <span class="stat-value">{{ product.students_count }}</span>
                <span class="stat-label">Students</span>
              </div>
            {% endif %}
          </div>
        {% endif %}
        
        {% render 'trust-badges' %}
      </div>
    </div>
    
    {% section 'product-details' %}
    
    {% if settings.show_related_products %}
      {% section 'related-products' %}
    {% endif %}
  </div>
</div>